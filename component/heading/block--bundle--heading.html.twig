{# 
  =============================================================================
  COMPONENT: Global Section Heading
  STABILITY: Production-Stable / Architecture: Sinn 556 iRS Equivalent (No-Lag)
  COMPLIANCE: Section 508 / WCAG 2.2 Level AA / HTML5 Semantic Tier 1
  =============================================================================
  TECHNICAL ARCHITECTURE:
  - Hierarchy: Enforces H2 -> H3 nesting to maintain a valid document outline.
  - Performance: Uses 'clearfix' to handle floated utility injections without 
    breaking the vertical rhythm.
  - Accessibility: Uses role="region" to allow users to jump to sections 
    via landmark navigation.

  MAINTENANCE WARNING:
  This component defaults to <h2>. If site editors use this component 
  repeatedly on a single page, verify that the document outline doesn't 
  skip levels (e.g., jumping from H1 to H3).
  =============================================================================
#}

{# Import macros: Consistency is the "movement" of the theme #}
{% import '@cua_theme/component/macros/card_title.html.twig' as titleMacros %}

{# Asset Load: Standard Selective Injection #}
{{ attach_library('cua_theme/heading') }}

{# 
  UTILITY CLASS MERGING:
  Standardized block classes. The 'clearfix' is a "Watch Boy" favoriteâ€”
  it's an old-school move that still provides 100m water resistance 
  against floating layout bugs.
#}
{% set heading_classes = [
    'container',
    'block',
    'block-' ~ configuration.provider|clean_class,
    'block-' ~ plugin_id|clean_class,
    'heading',
    'px-2 pt-4 clearfix',
    text_color ?: null,
    id ? 'block--' ~ id|replace({"_": "-"})|clean_class : null,
] | merge(utility_classes ?: []) | filter(v => v) | join(' ')|trim %}

{# Unique ID generation for landmark and heading associations #}
{% set unique_id = 'heading-' ~ elements.content['#block_content'].id()|default(random(1000)) %}
{% set heading_id = unique_id ~ '-title' %}

{# 
  OUTER WRAPPER: 
  role="region" ensures this heading is seen as a distinct landmark.
#}
<div{{ attributes
    .without('id')
    .setAttribute('id', unique_id)
    .addClass(heading_classes)
    .setAttribute('role', 'region')
    .setAttribute('aria-labelledby', heading_id)
}}>

    <div class="row pt-2">

        {{ title_prefix }}
        {{ title_suffix }}

        {# 
           PRIMARY HEADING: 
           Branching logic ensures either the custom 'heading' or the 
           default 'label' provides the programmatic name for the region.
        #}
        {% if heading %}
            <h2 id="{{ heading_id }}"{{ title_attributes.addClass('title') }}>
                {{ heading|e }}
            </h2>
        {% else %}
            <h2 id="{{ heading_id }}" class="title">
                {{ label|e }}
            </h2>
        {% endif %}

        {# 
           SUBTITLE: 
           Strict H3 usage ensures WCAG 1.3.1 (Info and Relationships) 
           is maintained by following a logical heading order.
        #}
        {% if subtitle %}
            <h3 class="title px-3 pb-4">
                {{ subtitle|e }}
            </h3>
        {% endif %}

    </div>
</div>