{#
Counter Component Template
#}

{{ attach_library('cua_theme/counter') }}

{% import '@cua_theme/component/macros/card_title.html.twig' as titleMacros %}
{% import '@cua_theme/component/macros/card_counter.html.twig' as counterMacros %}

{% set unique_id = 'block--node--counter--' ~ elements.content['#block_content'].id()|replace({"_": "-", ":": "--"}) %}
{% set title_id = unique_id ~ '-title' %}

{% set counter_classes = [
    'block',
    'block-' ~ configuration.provider|clean_class,
    'counter',
    'card', 'rounded-0', 'mx-2', 'p-3',
    color_background ?: null,
    color_border ?: null,
    container_size ?: null,
    id ? 'block--' ~ id|replace({'_': '-'})|clean_class : null
] | merge(utility_classes|default([])) | filter(v => v) | join(' ') %}

<div{{ attributes
|without('id')
    .setAttribute('id', unique_id)
    .addClass(counter_classes)
    .setAttribute('role', 'region')
    .setAttribute('aria-labelledby', title_id)
}}>

    {# Accessible heading for screen readers and ARIA reference #}
    <h3 id="{{ title_id }}" class="visually-hidden">
        {{ label ?: 'Counter Block' }}
    </h3>

    {# Optional visual title (if needed for display) #}
    {% if label %}
        <div class="text-align-center h4-text title cu-text-black">
            {{ label }}
        </div>
    {% endif %}

    {# Counter display with ARIA live region #}
    <div class="counter-size d-flex justify-content-center cu-text-black">
    <span class="counter-up cu-text-black"
          aria-live="polite"
          role="status"
          aria-hidden="false"
          data-count="{{ number }}">
      {{ number }}
    </span>
        <span class="visually-hidden" data-counter-announcer="">
      Counter: {{ number }}
    </span>
    </div>

    {# Optional descriptive body content #}
    {% if content %}
        {% import '@cua_theme/component/macros/card_body.html.twig' as bodyMacros %}
        {{ bodyMacros.render_body(
            content,
            padding,
            text_color,
            text_alignment
        ) }}
    {% endif %}

    {# Optional links or buttons #}
    {% if links %}
        {% import '@cua_theme/component/macros/card_footer.html.twig' as cardFooterMacros %}
        {{ cardFooterMacros.render_card_footer(
            links,
            container_size,
            color_background,
            position_container,
            text_alignment,
            padding,
            outline,
            button_color,
            button_layout
        ) }}
    {% endif %}

</div>