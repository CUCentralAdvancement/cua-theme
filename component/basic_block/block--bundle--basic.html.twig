{# 
  =============================================================================
  COMPONENT: Basic Content Block
  STABILITY: Production-Stable / Architecture: Sinn 556 iRS Equivalent (No-Lag)
  COMPLIANCE: Section 508 / WCAG 2.2 Level AA / Schema.org Structured Data
  =============================================================================
  TECHNICAL ARCHITECTURE:
  - Built for Drupal 11. Implements 'WebPageElement' Schema for SEO depth.
  - Data-Hardened: Manual <a> rendering for single-link scenarios to bypass 
    macro limitations for GA4 data-attributes.
  - Flexibility: Branching logic for Card Image vs. Icon to prevent DOM bloat.

  MAINTENANCE WARNING:
  The GA4 event 'data-ga-action' is derived from the link title or block label. 
  Ensure editors provide concise titles to prevent oversized event strings 
  in Analytics dashboards.
  =============================================================================
#}

{# Import macros: Atomic logic for Title, Image, Icon, and Body #}
{% import '@cua_theme/component/macros/card_title.html.twig' as titleMacros %}

{# Utility Class Merging: Merging CMS-side utility classes with Bootstrap card logic #}
{% set basic_classes = [
    'block',
    'block-' ~ configuration.provider|clean_class,
    'block-' ~ plugin_id|clean_class,
    'basic-block',
    'card px-4 py-1',
    text_alignment ?: null,
    text_color ?: null,
    color_background ?: null,
    id ? 'block--' ~ id|replace({"_": "-"})|clean_class : null,
] | merge(utility_classes ?: []) | filter(v => v) | join(' ') %}

{# Unique ID: Critical for GA4 component tracking and ARIA landmarking #}
{% set unique_id = 'block--node-basic-block--' ~ elements.content['#block_content'].id()|replace({"_": "-", ":": "--"}) %}

{# GA4/SEO Logic: Determine if we should trigger the manual "Pro-link" render #}
{% set links_count = links|length %}
{% set single_link = (links_count == 1) ? links|first : null %}

{# 
  OUTER WRAPPER:
  - role="region": Identified as a landmark for assistive tech.
  - itemscope/itemtype: Provides machine-readable context to search crawlers.
  - data-component: Internal hook for automated testing (Cypress/Playwright).
#}
<div{{ attributes
    .without('id')
    .setAttribute('id', unique_id)
    .addClass(basic_classes)
    .setAttribute('role', 'region')
    .setAttribute('itemscope', '')
    .setAttribute('itemtype', 'https://schema.org/WebPageElement')
    .setAttribute('data-component', 'basic-block')
}}>

    {{ title_prefix }}
    {{ title_suffix }}

    {# 
       A11Y FALLBACK: 
       Ensures the region landmark is named for screen readers even if 
       no visible heading is rendered. 
    #}
    {% if not label %}
        <span class="sr-only bg-black text-white">
            {{ 'Content Section'|t }}
        </span>
    {% endif %}

    {# 
       MEDIA LAYER: 
       Strict branching logic. We prioritize the Card Image over the Icon 
       to ensure the visual hierarchy remains consistent.
    #}
    {% if card_image %}
        {% import '@cua_theme/component/macros/card_image.html.twig' as cardImageMacros %}
        {{ cardImageMacros.render_card_image(card_image, position_container, text_alignment, text_color, image_size, visibility, content, links) }}
    {% elseif icon %}
        {% import '@cua_theme/component/macros/card_icon.html.twig' as iconMacros %}
        {{ iconMacros.render_icon(icon, icon_size, icon_color, padding, position_container, text_alignment) }}
    {% endif %}

    {# TITLE LAYER: Includes itemprop="name" (or custom) for Schema.org crawlers #}
    {{ titleMacros.render_title(label, title_prefix, title_suffix, center_content, text_alignment, text_color, padding, 'itemprop="name"') }}

    {# BODY LAYER: Handled via macro to respect Drupal's text filters/sanitization #}
    {% if content %}
        {% import '@cua_theme/component/macros/card_body.html.twig' as bodyMacros %}
        {{ bodyMacros.render_body(content, padding, text_color, text_alignment) }}
    {% endif %}

    {# 
       FOOTER / CTA LAYER: 
       This is where the 'Names and Notes' philosophy lives.
    #}
    {% if links %}
        {% if single_link %}

            {# SCENARIO 1: SINGLE LINK - The Manual 'Hammer' for GA4 accuracy #}
            {% set outline_class = outline ? outline ~ 'btn-' ~ button_color : 'btn-' ~ button_color %}
            {% set link_classes = ['card-link', 'btn', outline_class, 'text-decoration-none', 'p-2', 'mt-3']|filter(v => v)|join(' ') %}

            <div class="card-footer d-flex container mb-5">
                <a href="{{ single_link.url ?: '#' }}"
                   class="{{ link_classes }}"
                   data-ga-event="basic_block_link"
                   data-ga-category="basic_block"
                   data-ga-action="{{ single_link.title|default(label)|striptags|trim|e }}"
                   data-ga-component-id="{{ unique_id }}">
                    {{ single_link.title|default('Learn More'|t) }}
                </a>
            </div>
        {% else %}
            {# SCENARIO 2: MULTIPLE LINKS - Standard macro fallback with attribute injection #}
            {% import '@cua_theme/component/macros/card_footer.html.twig' as cardFooterMacros %}
            {% set ga_attributes = {
                'data-ga-event': 'basic_block_link',
                'data-ga-category': 'basic_block',
                'data-ga-component-id': unique_id
            } %}
            {{ cardFooterMacros.render_card_footer(links, container_size, color_background, position_container, text_alignment, padding, outline, button_color, button_layout, false, false, ga_attributes) }}
        {% endif %}
    {% endif %}

</div>