{#
@file
Accessible Drupal Twig template for a "Button" block component.
Uses macros and ARIA best practices for 508/WCAG compliance.
#}

{% import '@cua_theme/component/macros/card_title.html.twig' as titleMacros %}
{% import '@cua_theme/component/macros/card_body.html.twig' as bodyMacros %}

{{ attach_library('cua_theme/call-to-action') }}

{# Define CSS classes for the block wrapper #}
{% set button_classes = [
    'block',
    'block-' ~ configuration.provider|clean_class,
    'button card',
    color_border ?: null,
    text_alignment ?: null,
    text_color ?: null,
    id ? 'block--' ~ id|replace({'_': '-'})|clean_class : null
] | merge(utility_classes ?: []) | filter(v => v) | join(' ') %}

{# Generate unique IDs for block and heading for aria-labelledby compliance #}
{% set unique_id = 'block--node--button--' ~ elements.content['#block_content'].id()|replace({'_': '-', ':': '--'}) %}
{% set heading_id = unique_id ~ '-title' %}

{# Footer and button styling #}
{% set outline_class = outline ? outline ~ 'btn-' ~ button_color : 'btn-' ~ button_color %}
{% set card_footer_classes = [
    'card-footer',
    'd-flex',
    multiple_links ? 'multiple-links' : '',
    container_size,
    position_container,
    text_alignment,
    padding,
    'mb-5',
    'me-3'
] | filter(v => v) | join(' ') %}

{% set card_footer_link_classes = [
    'card-link',
    'btn',
    outline_class,
    'text-decoration-none',
    position_container,
    text_alignment,
    'p-2',
    'mt-3',
    'me-2'
] | filter(v => v) | join(' ') %}

<div{{ attributes|without('id')
    .setAttribute('id', unique_id)
    .addClass(button_classes)
    .setAttribute('role', 'region')
    .setAttribute('aria-labelledby', heading_id) }}>

    {# Accessible semantic heading with optional link and ARIA compliance #}
    {{ titleMacros.render_title(
        label,
        title_prefix,
        title_suffix,
        center_content,
        text_alignment,
        text_color,
        padding,
        hide_from_screen_readers,
        links,
        heading_id,
        2
    ) }}

    {# Optional body content section #}
    {% if content %}
        {{ bodyMacros.render_body(
            content,
            padding,
            text_color,
            text_alignment
        ) }}
    {% endif %}

    {# Render card footer with call-to-action links #}
    <div class="{{ card_footer_classes }}"
         {% if multiple_links %}role="group" aria-label="{{ custom_label ?: 'Related links' }}"{% endif %}>

        {% for link in links %}
            {% if is_single_link %}
                <span class="{{ card_footer_link_classes }}" aria-label="{{ link.title }}">{{ link.title }}</span>
            {% else %}
                <a href="{{ link.url }}"
                   class="{{ card_footer_link_classes }}"
                   role="link"
                   {% if hide_from_screen_readers %}aria-hidden="true"{% endif %}
                   aria-label="{{ link.title }}">
                    {{ link.title }}
                </a>
            {% endif %}
        {% endfor %}
    </div>
</div>