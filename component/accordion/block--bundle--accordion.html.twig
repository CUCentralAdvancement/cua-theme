{# 
  =============================================================================
  COMPONENT: Global Content Accordion
  STABILITY: Production-Stable / Architecture: Sinn 556 iRS Equivalent (No-Lag)
  COMPLIANCE: Section 508 / WCAG 2.2 Level AA / ARIA 1.2 Region Landmark
  =============================================================================
  TECHNICAL ARCHITECTURE:
  - Supports Drupal 11 SDC (Single Directory Component) logic.
  - Implements the 'Region' landmark pattern for screen reader navigation.
  - Performance: Uses dynamic library attachment to prevent global CSS/JS bloat.
  
  MAINTENANCE WARNING:
  The ID generation uses elements.content['#block_content'].id(). If this is used 
  outside of a Block Context, fallback to a random(1000) seed to prevent 
  ID collisions which break ARIA aria-labelledby bindings.
  =============================================================================
#}

{# Asset Load: Attached only when the component is present in the render array #}
{{ attach_library('cua_theme/accordion') }}

{# 
  Utility Class Merging: 
  Maintains the 'Coast-Proof' architecture by merging backend utility 
  classes (spacing/colors) with the core functional classes.
#}
{% set accordion_classes = [
    'block',
    'block-' ~ configuration.provider|clean_class,
    'block-' ~ plugin_id|clean_class,
    'accordion',
    id ? 'block--' ~ id|replace({"_": "-"})|clean_class : null,
] | merge(utility_classes ?: []) | filter(v => v) | join(' ') %}

{# 
  ID ARCHITECTURE:
  We generate a persistent unique ID for the container and a linked ID 
  for the label to satisfy WCAG 1.3.1 (Info and Relationships).
#}
{% set unique_id = 'accordion-' ~ elements.content['#block_content'].id()|default(random(1000)) %}
{% set labelledby_id = unique_id ~ '--label' %}

{# 
  OUTER CONTAINER:
  - role="region": Identified as a landmark for assistive technology.
  - aria-labelledby: Connects the landmark to the section title.
#}
<div {{ attributes
    .setAttribute('id', unique_id)
    .addClass(accordion_classes)
    .setAttribute('role', 'region')
    .setAttribute('aria-labelledby', labelledby_id)
}}>

    {# 
      HEADING LAYER:
      If a title exists, it becomes the accessible label for the entire 
      accordion region. We use an H3 to maintain the document hierarchy.
    #}
    {% if label is not empty %}
        {{ title_prefix }}
        <h3 id="{{ labelledby_id }}" class="accordion-section-title mb-3">
            {{ label }}
        </h3>
        {{ title_suffix }}
    {% endif %}

    {# 
      CONTENT BLOCK: 
      Standard Bootstrap .content wrapper. Ensure the internal child 
      templates (accordion items) use <button> triggers rather than <a> tags 
      for the toggle actions to satisfy WCAG 2.1 Success Criterion 2.1.1.
    #}
    {% block content %}
        <div {{ content_attributes.addClass('content') }}>
            {{ content }}
        </div>
    {% endblock %}

</div>