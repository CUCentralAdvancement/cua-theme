{# 
  =============================================================================
  MACRO: render_card_footer
  STABILITY: Production-Stable / Architecture: Sinn 103 (Interactive)
  COMPLIANCE: Section 508 / WCAG 2.2 Level AA / Bootstrap 5.3
  =============================================================================
  TECHNICAL ARCHITECTURE:
  - Flexbox Layout: Uses 'd-flex' with dynamic positioning to allow CTAs to 
    align start, center, or end based on the card's visual balance.
  - Accessibility: Implements 'role="group"' for multiple CTAs, providing 
    semantic grouping for assistive technologies.
  - Logic: Filters invalid links (missing URL or Title) at the "gasket" level 
    to prevent empty button rendering.

  MAINTENANCE WARNING:
  The 'outline' parameter should be the Boolean 'true' or 'false'. The logic 
  automatically prepends 'btn-outline-' or 'btn-' based on the result.
  =============================================================================
#}

{% macro render_card_footer(
    links,
    container_size = null,
    color_background = null,
    position_container = null,
    text_alignment = null,
    padding = null,
    outline = null,
    button_color = 'primary',
    hide_from_screen_readers = false,
    is_single_link = false,
    custom_label = null
) %}

    {# Gasket: Filter out any links missing essential parts #}
    {% set links = links|default([])|filter(link => link.url is not empty and link.title is not empty) %}

    {% if links|length > 0 %}
        {% set multiple_links = links|length > 1 %}

        {# 
           BUTTON STYLING:
           Determines if we are using the "Solid" or "Instrument" (Outline) 
           look for the buttons.
        #}
        {% set btn_variant = outline ? 'btn-outline-' ~ button_color : 'btn-' ~ button_color %}

        {# FOOTER WRAPPER CLASSES #}
        {% set card_footer_classes = [
            'card-footer',
            'd-flex',
            'flex-wrap',
            multiple_links ? 'multiple-links gap-2' : '',
            container_size,
            position_container,
            text_alignment,
            padding,
            'mb-5',
            'border-0 bg-transparent'
        ] | filter(v => v) | join(' ') %}

        {# BUTTON CLASSES #}
        {% set card_footer_link_classes = [
            'card-link',
            'btn',
            btn_variant,
            'text-decoration-none',
            'p-2 mt-3',
        ] | filter(v => v) | join(' ') %}

        <div class="{{ card_footer_classes }}"
             {% if multiple_links %}
                role="group" 
                aria-label="{{ custom_label ?: 'Related links'|t }}"
             {% endif %}>

            {% for link in links %}
                {% if is_single_link %}
                    {# 
                       DECORATIVE BUTTON:
                       Used when the entire card is wrapped in an <a> tag.
                       aria-hidden="true" is essential here to prevent the 
                       screen reader from seeing two identical links.
                    #}
                    <span class="{{ card_footer_link_classes }}" aria-hidden="true">
                        {{ link.title|e }}
                    </span>
                {% else %}
                    {# STANDARD CTA #}
                    <a href="{{ link.url }}"
                       class="{{ card_footer_link_classes }}"
                       {% if hide_from_screen_readers %} aria-hidden="true" {% endif %}>
                        {{ link.title|e }}
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
{% endmacro %}